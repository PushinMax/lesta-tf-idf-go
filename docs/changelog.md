# [Feedback - StantStantov] - 2025-06-16
## Docs
- Не забудь указать, какие метрики ты возвращаешь и почему.
## Dev Exp
- Для удобства разработки можно добавить makefile, justfile, mise и т.п. В них можно создавать и запускать task'и - набор команд, закрепленные за именем. Например, твои команды из develop.md в makefile/justfile можно представить так:
```
kill:
    sudo kill -9 $(sudo lsof -t -i:8080)

ssh-remote:
    ssh ubuntu@37.9.53.117 -i ~/.ssh/private.key

generate-env:
    sh scripts/generate_env.sh

connect-db:
    docker exec -it postgres_db psql -U postgres
```
После этого будет достачно вызвать ```make generate-env``` или ```just generate-env```, чтобы создать .env файл.
## Docker
- Процесс компиляции можно ускорить, если ты позволишь Docker переиспользовать кэш. 
```
RUN --mount=type=cache,target=/go/pkg/mod \
go build ...
```
- Так как ты используешь golang:alpine, то тебе не обязательно делать CGO\_ENABLED=0.
- version в docker-compose ничего не делает - его можно удалить.
- На строчке 40 в docker-compose указано, что при запуске в prod нужно поменять порт - в таких случаях лучше создавать различные docker-compose, c конфигурациями для разных этапов (например, docker-compose.dev для локальной разработки и docker-compose.prod для запуска готового приложения).    
- Передавая параметры через env нужно учитывать, что если злоумышленник попадет в контейнер, то вызовом команды ```env``` он увидет все в чистом виде, в том числе и конфиденциальные параметры (DB_PASSWORD, JWT_ACCESS_SECRET, ...). Если есть возможность, то параметры стоит [передавать в виде секретов](https://docs.docker.com/compose/how-tos/use-secrets/) - так они будут зашифрованы.
## Swagger
- /collections, /documents, /logout требуют Authorization header, но его нельзя передать.
- /metrics должны возвращать не только тобою выбранные метрики, но и заранее заданные. См. конец 1 недели.
- /user/{user_id} требуют Path var, но их нельзя передать.
## Go, cmd
- Из интересного - начиная с 1.18 go build сохраняет в бинарнике информацию, где и как он был собран. Часть этой информации является какой VCS был использован. Этой фичей можно воспользоваться, чтобы не вбивать вручную версию API в конфиг. Почитать про это можно [здесь](https://pkg.go.dev/debug/buildinfo) и [здесь](https://shibumi.dev/posts/go-18-feature/).
## Go, api
- Для форматирования ошибок вместо fmt.Sprintf лучше использовать fmt.Errorf - у него есть специальный ```%w``` для оборачивания ошибок. В будущем это можеть помочь при обработке ошибок с помощью пакета errors.
- Если тебе нужно сохранять что-либо в context.Context, то в таких случаях рекомендуется создавать функции-помощники. Например, если тебе в контекст нужно сохранять ID пользователя - то стоит написать:
```
type userIdContextKey struct{}

func SetUserId(ctx context.Context, userId string) context.Context {
	return context.WithValue(ctx, userIdContextKey{}, userId)
}

func GetUserId(ctx context.Context) (string, bool) {
    return ctx.Value(userIdContextKey{}).(string)
}
```
Это распространяется и на кастомные context (например, gin.Context).
- Рекомендуется по-возможности избегать таких названий, как utils, common, helpers и т.д., так как они слишком абстрактны и ни о чем не говорят. В твоем случае utils.go стоит переименовать в dto.go, так как в нем хранятся классы для маршалинга в json и обратно. 
## Go, repository
- Лучше стараться наименовать файлы кратко и учитывай контекст пакета - например не auth_api.go, а auth_repo.go или просто auth.go. Также в GO принято писать в camelCase.
- Можешь попробовать задавать sql запросы в виде const - так приложения не будет создавать каждый раз строку запроса, а также позволит писать их в несколько строк. Например:
```
const selectUser = `
    SELECT *
    FROM users
    WHERE login = $1
    LIMIT 1
    ;
`
```
- Если ты хочешь проверить, существует ли строка в таблице, то лучше использовать SELECT EXISTS:
```
const checkUser = `
    SELECT EXISTS
    (SELECT 1
    FROM users
    WHERE login = $1
    LIMIT 1)
    ;
`
```
Достаточно db.QueryRow(), а потом row.Scan() в bool переменную. 
- Лучше чтение переменных конфигов перенести в отдельный класс/функцию - прямо сейчас все как-то перемешанно.
- utils.go лучше переименовать в models.go или entities.go, так как в нем хранятся представление сущностей бизнес-логики.
## Go, schema
- Пакет schema, возможно, стоит переименовать в models или entities по выше изложенным причинам.
- Стоит перенести utils.go из repository сюда.
## Go, service
- Наверное, стоит попробовать перенести чтения конфига в отдельный класс/функцию/пакет
- Форматирование похрамывает. Как вариант, можно попробовать сделать гит-хук, который будет форматировать все файлы перед коммитом.
- interface{} можно заменить на any.
- Если ты хочешь сделать set(map, который хранит только ключи), то лучше использовать map[T]struct{}. В Go struct{} весит 0 бит, что позволяет немного сэкономить на памяти не теряя в функционале.
- Опять напоминаю про utils.go.


# [1.5.0] - 2025-06-16
## Added
- Подключена Swagger документация


# [1.4.0] - 2025-06-15
## Added
- Добавлены middleWare для сбора метрик
- Добавленная ручка для получения кода huffman документа


# [1.3.0] - 2025-06-13
## Added
- Дописано api смены пароля, удаления аккаунта, logout и операции refresh



# [1.2.0] - 2025-06-09
## Added
- Добавленна mongoDB для хранения документов и коллекций
- Добавленно api для работы с документами и коллекциями
## Instruments
- Для работы с mongoDB: go.mongodb.org/mongo-driver


# [1.1.0] - 2025-06-4
## Added
- Добавлен posgreSQL для хранения информации о ползователях
- Добавленно statusAPI для проверки работы сервиса
- Добавленно API для регистрации и входа в систему. Добавлен middleware для проверки валидности access токена.
- Добавлено API смены пароля

## Instruments
- Для работы с токенами: golang-jwt
- Для работы с db: sqlx


# [1.0.0] - 2025-06-02
## Comment
Функциональность переписана с python на go
## Added
- Написан docker-compose для быстрого запуска
- Описаны конфиги для запуска и .env для хранения секретных данных
- Добавлен nginx для проксирования запросов
- Написан js скрипт, позволяющий переключать страницы без повторного обращения к сервису
## instruments
- В качестве веб-сервиса использую фрейморк gin.
- Для работы с переменными окружения godotenv.
- Для работы с данными конфигурации приложения - viper.



